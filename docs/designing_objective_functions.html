<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Designing objective functions &mdash; TopasOpt  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Environment set up" href="EnvironmentSetup.html" />
    <link rel="prev" title="Next steps (work in progress!)" href="next_steps.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> TopasOpt
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="worked_examples.html">Worked Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="next_steps.html">Next steps (work in progress!)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Designing objective functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#competing-objectives">Competing objectives</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hard-boundaries">Hard boundaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="#log-of-objective-function">Log of objective function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#handling-constraints">Handling constraints</a></li>
<li class="toctree-l2"><a class="reference internal" href="#convergence-criteria">Convergence criteria</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="EnvironmentSetup.html">Environment set up</a></li>
<li class="toctree-l1"><a class="reference internal" href="DeveloperNotes.html">Developer Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="code_docs.html">Code documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TopasOpt</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Designing objective functions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/designing_objective_functions.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="designing-objective-functions">
<h1>Designing objective functions<a class="headerlink" href="#designing-objective-functions" title="Permalink to this headline"></a></h1>
<p>The optimisers implemented in this library are so called ‘black box’ optimisers, which means they don’t know anything about the objective function or make any assumptions about it’s shape. This means that you can literally make your objective function anything you want, the only requirement is that it returns a number to the optimiser.</p>
<p>Having said this, having a well crafted objective function can absolutely be the difference between success and failure. The below are some things you may want to consider when you are writing your objective function.</p>
<section id="competing-objectives">
<h2>Competing objectives<a class="headerlink" href="#competing-objectives" title="Permalink to this headline"></a></h2>
<p>Let’s take a trivial example: say you are building a table; you want to minimise the mass, but maximise the strength. Clearly these objectives will ‘fight’ each other.</p>
<p>In this library, we do ‘single criteria optimisation’, which means the objective function can only return one number. That means you have to encapsulate both priorities in the objective function. A simple way to do this is below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">objective_function</span> <span class="o">=</span> <span class="o">-</span><span class="n">weight_strength</span><span class="o">*</span><span class="n">strength</span> <span class="o">+</span> <span class="n">weight_mass</span><span class="o">*</span><span class="n">mass</span>
</pre></div>
</div>
<p>(Note that we want strength to be high - since we are <strong>minimising</strong> this function, we use -strength).</p>
<p>Clearly, the ‘best’ solution that will be found in this case depends on how you weight these objectives. This can take some trial and error and experience to get right.</p>
<p>A more elegant, but more complicated way to handle these situations is via <a class="reference external" href="https://en.wikipedia.org/wiki/Multi-objective_optimization">multi-objective or pareto optimisation</a>. We do not currently have an implementation of this for this library although pull requests are welcome!</p>
</section>
<section id="hard-boundaries">
<h2>Hard boundaries<a class="headerlink" href="#hard-boundaries" title="Permalink to this headline"></a></h2>
<p>Let’s continue using our table from above. Although we have initially stated that we want maximum strength, this is probably not really true - we just want the strength to be above some threshold. This is another very common situation, and in code looks like below :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">strength_sufficient</span><span class="p">:</span>
	<span class="n">objective_function</span> <span class="o">=</span> <span class="mi">0</span> 
<span class="k">else</span><span class="p">:</span>
	<span class="n">objective_function</span> <span class="o">=</span> <span class="n">large_number</span>  <span class="c1"># penalise the case where our condition is not met</span>
</pre></div>
</div>
<p>The problem with this form is that it results in a discontinuity in the objective function. Although the optimisation will still run, it may not bconverge as fast as it could. In such cases it is better to “smooth” the discontinuity using a <a class="reference external" href="https://en.wikipedia.org/wiki/Sigmoid_function">sigmoid function</a>. Having said this, in my experience with the Bayesian optimiser it didn’t actually make much difference - but at the very least a smooth objective function gives reviewers less to complain about ;-)</p>
</section>
<section id="log-of-objective-function">
<h2>Log of objective function<a class="headerlink" href="#log-of-objective-function" title="Permalink to this headline"></a></h2>
<p>It is pretty common that large swarthes of the objective space are ‘bad’ i.e. have a high objective function. In some cases, it is desirable to flatten out these bad regions so the optimisation algorithm doesn’t get ‘distracted’ by high gradient errors in ‘bad regions’. For instance, maybe your objective function ranges between 0 and 100, but you are really interested in the spaces between 0 and 1. The optimiser may find a very steep gradient that goes from 20 to 2, which to it may seem more interesting than a shallow gradient in a different region that may go from 2 to 1.2.</p>
<p>In such situations, you may wish to take the log of the objective function. This has the effect of surpressing the differences in high value  (bad)regions and enhancing the differences in the low value (good) regions.</p>
</section>
<section id="handling-constraints">
<h2>Handling constraints<a class="headerlink" href="#handling-constraints" title="Permalink to this headline"></a></h2>
<p>At the moment, this code handles boundaries (0&lt;=x&lt;=1) but not constraints (x&lt;=2*y). Nevertheless, it is very common that the allowed values for one variable are dependant on the values of another variable.</p>
<p>I hope that in the future we will be able to handle these cases in the problem set up, but for now, I recomend just returning a high number. Although this does contradict my earlier advice to try and ensure the objective function is smooth, it is less important to ensure this in ‘bad’ regions, since a good algorithm will not pay too much attention to these regions anyway.</p>
</section>
<section id="convergence-criteria">
<h2>Convergence criteria<a class="headerlink" href="#convergence-criteria" title="Permalink to this headline"></a></h2>
<p>At the moment, this code is primarily set up to terminate based on number of iterations, e.g. if you figure you have 24 hours of computing time available, figure out how many iterations you can run for. It is of course possible in principle to use different convergence criteria - e.g.</p>
<ul class="simple">
<li><p>if the solution hasn’t been improved on for N iterations, stop</p></li>
<li><p>if the solution is x times better than the starting solution, stop</p></li>
</ul>
<p>At the moment, these aren’t coded , but will be considered in future versions!</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="next_steps.html" class="btn btn-neutral float-left" title="Next steps (work in progress!)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="EnvironmentSetup.html" class="btn btn-neutral float-right" title="Environment set up" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Brendan Whelan(s).</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>